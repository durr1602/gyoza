##### Ad-hoc conda apptainer #####

containerized: "docker://durr1602/gyoza:latest"

##### Set up report #####

report: "report/workflow.rst"

##### Load rules #####

include: "rules/common.smk"
include: "rules/qc.smk"
include: "rules/cutadapt.smk"
include: "rules/pandaseq.smk"
include: "rules/vsearch.smk"
include: "rules/stats.smk"
include: "rules/generate_mutants.smk"
include: "rules/parse_fasta.smk"
include: "rules/process_read_counts.smk"

##### Target(s) #####
rule all:
    input:
        get_target()

##### Generate report that includes all completed steps #####
if config['report']['generate']:
    expected_in_report = ['multiqc', 'parse_fasta', 'process_read_counts']
    report_args = []
    for r in expected_in_report:
        if exists(f"results/done/{r}.done"):
            report_args.append(r)
    if len(report_args) > 0:
        shell(f"snakemake {' '.join(report_args)} --report results/report.html")